from os import listdir
from os.path import isfile
from os.path import abspath
from os.path import dirname
from os.path import sep
from os.path import basename
from prompt_toolkit.completion import WordCompleter
from prompt_toolkit.styles import Style
from prompt_toolkit import prompt
from colored import fg, attr

class cli:
    _menu_ = {
        "help": "show this help menu",
        "show": "get all available exploits",
        "select": "select an exploit by number",
        "cls": "clear screen",
        "back": "go back to previous menu",
        "exit": "exit program"
    }
    _exploits_path = dirname(abspath(__file__))

    def show(self):
        print("Exploits:")
        i = 0
        self.exploits = [f.rstrip(".py")
                for f in listdir(self._exploits_path)
                if isfile(f"{self._exploits_path}{sep}{f}")]
        this_file = basename(__file__).rstrip(".py")
        for exploit in self.exploits:
            if exploit in (this_file, "exploit"):
                continue
            else:
                print(f"\t[{i}] {exploit}")
                i += 1

    def select(self):
        pass

    def help(self):
        print("Menu:")
        for option, description in self._menu_.items():
            print(f"\t{option}\t\t{description}")

    def init(self):
        exit = False
        menu_words = WordCompleter(self._menu_.keys(), ignore_case=True)
        style = Style.from_dict({
            "prompt": "#ff0000"
        })
        message = [("class:prompt", "〔exploits〕❯ ")]
        while True:
            try:
                selected = prompt(
                    message,
                    style=style,
                    completer=menu_words,
                    complete_while_typing=False
                ).strip()
            except (KeyboardInterrupt, EOFError):
                break
            if selected == "show":
                self.show()
            elif selected == "help":
                self.help()
            elif selected == "cls":
                print("\n"*75)
            elif selected == "back":
                break
            elif selected == "exit":
                exit = True
                break
        return exit
